== Crunchy Operator
v1.0.0, {docdate}

image::docs/crunchy_logo.png?raw=true[]

Crunchy Operator provides a Kubernetes operator capability
for managing PostgreSQL containers deployed within a Kubernetes cluster.

# Usage

Some examples of using the command line interface:

.Display Database or Cluster Information
[source,bash]
----
crunchy show database all
crunchy show database db1 db2 db3
crunchy show cluster mycluster
----

.Create Database or Cluster
[source,bash]
----
crunchy create database mydatabase
crunchy create cluster mycluster
----

.Delete a Database or Cluster
[source,bash]
----
crunchy delete database mydatabase
crunchy delete cluster mycluster
----

.Backup Database or Cluster
[source,bash]
----
crunchy backup mycluster
crunchy backup mydatabase
----


# Crunchy-Operator Container

The operator funtionality runs in a Pod deployed to your
Kubernetes cluster.  The *crunchy-operator* Docker container
is available on Dockerhub.  

You can also build the Docker image for *crunchy-operator* using
the build instructions below.

The first step to using the operator is to deploy
the operator container to your Kubernetes environment
by running the script located at:
TODO

Verify the operator is running:
....
kubectl get pod TODO
....

Verify the operator installed the following ThirdPartyResources:
....
kubectl get thirdpartyresources
TODO
....

# Command Line Interface

With the operator deployed, you can then use the *crunchy* command line 
interface to execute commands that the *crunchy-operator* understands 
and reacts to.

You can download a pre-built *crunchy* CLI binary from 
the Releases page on the github repository or build
it yourself using the build instructions below.


# Build and Setup Instructions

Here are the steps required to build the operator and CLI
from source:

=== Create Project and Clone 
....
mkdir -p $HOME/odev/src $HOME/odev/bin $HOME/odev/pkg
export GOPATH=$HOME/odev
export GOBIN=$GOPATH/bin
mkdir -p $GOPATH/src/github.com/crunchydata/
cd $GOPATH/github.com/crunchydata
git clone https://github.com/CrunchyData/crunchy-operator.git
cd crunchy-operator
export COROOT=$GOPATH/src/github.com/crunchydata/crunchy-operator
....

==== Get the dependencies:
....
cd $COROOT
go get -u github.com/FiloSottile/gvt
gvt restore
....

==== Compile the CLI:
....
cd $COROOT
make clientcli
which crunchy
....

==== Compile and build the operator Docker image:
....
cd $COROOT
make operatorimage
docker images | grep operator
....

==== Deploy the Crunchy ThirdPartyResources
....
cd $COROOT/examples/tpr
./run.sh
kubectl get thirdpartyresources
....

==== Deploy the Crunchy Operator
note that this will create and use */data* on your
local system as the persistent store for the operator to use
for its persistent volume:
....
cd $COROOT/examples/operator
./run.sh
kubectl get pod -l 'name=crunchy-operator'
....

Note that this example will create a PVC called *crunchy-pvc* that is
referenced in the examples and *crunchy* configuration file as the
desired PVC to use when databases and clusters are created.

==== Setup initial configuration file for the crunchy CLI
....
cp $COROOT/examples/sample.crunchy.yaml $HOME/.crunchy.yaml
....

Note that this config file assumes your Kubernetes config file is
located in */etc/kubernetes/admin.conf*.  Update this kubeconfig
path to match your local Kube config file location.


