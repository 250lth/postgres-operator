<!DOCTYPE html>
<html>
  <head>
    <title>Crunchy Data PostgreSQL Operator Documentation</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.40.3" />

<title>Manual Installation :: Crunchy Data PostgreSQL Operator Documentation</title>
<link rel="shortcut icon" href="https://crunchydata.github.io/postgres-operator/favicon.ico" type="image/x-icon" />
<link href="https://crunchydata.github.io/postgres-operator/css/nucleus.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/css/font-awesome.min.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/css/hybrid.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/css/featherlight.min.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/css/auto-complete.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/theme-original/style.css" rel="stylesheet">

<link rel="stylesheet" href="https://crunchydata.github.io/postgres-operator/css/bootstrap.min.css">
<script src="https://crunchydata.github.io/postgres-operator/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<meta name="description" content="">


    
  </head>
  <body data-url="/installation/manual-installation/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <a class="baselink" href="https://crunchydata.github.io/postgres-operator/">Crunchy Data PostgreSQL Operator Documentation</a>
  

    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/js/lunr.min.js"></script>
		<script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "https:\/\/crunchydata.github.io\/postgres-operator\/";
        
		</script>
		<script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/" class="dd-item">
            <a href="https://crunchydata.github.io/postgres-operator/"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/installation/" class="dd-item parent haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/installation/">Installation</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="/installation/quick-installation/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/quick-installation/">
            Quick Installation
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/manual-installation/" class="dd-item active">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/manual-installation/">
            Manual Installation
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/helm-chart/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/helm-chart/">
            Helm Chart
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/upgrading-the-operator/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/upgrading-the-operator/">
            Upgrading the Operator
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/deployment/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/deployment/">
            Deployment
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/configuration/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/configuration/">
            Configuration
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/contributing/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/contributing/">Contributing</a>

      </div>
    </li>
    <li data-nav-id="/how-it-works/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/how-it-works/">How it Works</a>

      </div>
    </li>
    <li data-nav-id="/getting-started/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/getting-started/">Getting Started</a>

      </div>
    </li>



        <section id="shortcuts">
                <li class="" role=""><h3>More</h3><a href="https://github.com/CrunchyData/postgres-operator" target="_blank" rel="noopener"><i class='fa fa-github'></i> <label>Github repo</label></a></li>
                <li class="" role=""><a href="https://github.com/CrunchyData/postgres-operator/releases/download/2.6/postgres-operator.2.6.tar.gz" target="_blank" rel="noopener"><i class='fa fa-cloud-download'></i> <label>Download</label></a></li>
                <li class="" role=""><a href="https://kubernetes.io/docs/" target="_blank" rel="noopener"><i class='fa fa-bookmark'></i> <label>Kubernetes Documentation</label></a></li>
                <li class="" role=""><a href="https://github.com/CrunchyData/postgres-operator/blob/master/LICENSE.md" target="_blank" rel="noopener"><i class='fa fa-file'></i> <label>License</label></a></li>
        </section>

    <hr />
    <li></li>

    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    
      
      
      
    <div id="top-github-link">
      <a class="github-link" href="https://crunchydata.github.io/postgres-operator/contributing/" target="blank">
        <i class="fa fa-info-circle"></i>
        How to contribute
      </a>
      <a class="github-link" href="https://github.com/CrunchyData/postgres-operator/edit/master/hugo/content/installation/manual-installation.adoc" target="blank">
        <i class="fa fa-code-fork"></i>
        Improve this page
      </a>
    </div><div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        







 <a href='https://crunchydata.github.io/postgres-operator/'>Crunchy Data PostgreSQL Operator</a> > <a href='https://crunchydata.github.io/postgres-operator/installation/'>Installation</a> > Manual Installation






        </span>
    </div>

    
    <div class="progress">
        <div class="wrapper">
    
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Manual Installation</h1>
  



    
    
    
    :toc:
v3.0, {docdate}

== Project Structure

To perform an installation of the operator, first create the project structure as follows on your host, here we assume a local directory called *odev* -
....
export GOPATH=$HOME/odev
mkdir -p $HOME/odev/src $HOME/odev/bin $HOME/odev/pkg
mkdir -p $GOPATH/src/github.com/crunchydata/
....

Next, get a tagged release of the source code -
....
cd $GOPATH/src/github.com/crunchydata
git clone https://github.com/CrunchyData/postgres-operator.git
cd postgres-operator
git checkout 3.0
....

== Installation Prerequsites

To run the operator and the *pgo* client, you will need the following -

 * a running Kubernetes or OpenShift cluster
 * the kubectl or oc clients installed in your PATH and configured to connect to the cluster (e.g. export KUBECONFIG=/etc/kubernetes/admin.conf)
 * a Kubernetes namespace created and set to where you want the operator installed. For this install we assume a namespace of *demo* has been created.
....
kubectl create -f examples/demo-namespace.json
kubectl config set-context $(kubectl config current-context) --namespace=demo
kubectl config view | grep namespace
....

[WARNING]
====
If you are not using the *demo* namespace, it will be required to edit the following and change the namespace where the service account and cluster role bindings will be deployed.

`$COROOT/deploy/service-account.yaml`

`$COROOT/deploy/cluster-role-binding.yaml`
====

Permissions are granted to the Operator by means of a Service Account called *postgres-operator*.  That service account is added to the Operator deployment.

The postgres-operator service account is granted cluster-admin priviledges using a cluster role binding *postgres-operator-cluster-role-binding*.

See link:https://kubernetes.io/docs/admin/authorization/rbac/[here] for more details on how to enable RBAC roles and modify the scope of the permissions to suit your needs.

== Basic Installation

The basic installation uses the default operator configuration settings, these settings assume you want to use HostPath storage on your Kube cluster for database persistence.  Other persistent options are available but require the Advanced Installation below.

=== Create HostPath Directory

The default Persistent Volume script assumes a default HostPath directory be created called */data*:
....
sudo mkdir /data
sudo chown 777 /data
....

Create some sample Persistent Volumes using the following script:
....
export CO_NAMESPACE=demo
export CO_CMD=kubectl
export COROOT=$GOPATH/src/github.com/crunchydata/postgres-operator
go get github.com/blang/expenv
$COROOT/pv/create-pv.sh
....

== Build Images & Deploy

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
        
        Packaged Images
        
        </span>
    </div>
    <div class="expand-content" style="display: none;">


=== Packaged Images

To pull prebuilt versions from Dockerhub of the *postgres-operator* containers, specify the image versions, and execute the following Makefile target -
....
export CO_IMAGE_PREFIX=crunchydata
export CO_IMAGE_TAG=centos7-3.0
make pull
....

To pull down the prebuilt *pgo* binaries, download the *tar.gz* release file from the following link -

 * link:https://github.com/CrunchyData/postgres-operator/releases[Github Releases]
 * extract (e.g. tar xvzf postgres-operator.3.0.tar.gz)
....
cd $HOME
tar xvzf ./postgres-operator.3.0.tar.gz
....
 * copy *pgo* client to somewhere in your path (e.g. cp pgo /usr/local/bin)

Next, deploy the operator to your Kubernetes cluster -
....
cd $COROOT
make deployoperator
....


    </div>
</div>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
        
        Build from Source
        
        </span>
    </div>
    <div class="expand-content" style="display: none;">


=== Build from Source

The purpose of this section is to illustrate how to build the PostgreSQL
Operator from source. These are considered advanced installation steps and
should be primarily used by developers or those wishing a more precise
installation method.

==== Requirements

The postgres-operator runs on any Kubernetes and Openshift platform that supports
Custom Resource Definitions. The Operator is tested on Kubeadm and OpenShift
Container Platform environments.

The operator is developed with the Golang versions greater than or equal to version 1.8. See
link:https://golang.org/dl/[Golang website] for details on installing golang.

The Operator project builds and operates with the following containers -

* link:https://hub.docker.com/r/crunchydata/pgo-lspvc/[PVC Listing Container]
* link:https://hub.docker.com/r/crunchydata/pgo-rmdata/[Remove Data Container]
* link:https://hub.docker.com/r/crunchydata/postgres-operator/[postgres-operator Container]
* link:https://hub.docker.com/r/crunchydata/pgo-apiserver/[apiserver Container]
* link:https://hub.docker.com/r/crunchydata/pgo-load/[file load Container]

This Operator is developed and tested on the following operating systems but is known to run on other operating systems -

* *CentOS 7*
* *RHEL 7*

First, install the project library dependencies. The godep dependency manager is used for this purpose. -
....
cd $COROOT
make setup
....

Then, compile the PostgreSQL Operator using the Makefile.
....
cd $COROOT
make all
which pgo
....

Finally, deploy the operator to your Kubernetes cluster.
....
cd $COROOT
make deployoperator
....


    </div>
</div>

== Makefile Targets

The following table describes the Makefile targets -
  
.Makefile Targets
[width="80%",frame="topbot",options="header"]
|======================
|Target | Description
|all        | compile all binaries and build all images
|setup        | fetch the dependent packages required to build with
|deployoperator        | deploy the Operator (apiserver and postgers-operator) to Kubernetes
|main        | compile the postgres-operator
|runmain        | locally execute the postgres-operator
|pgo        | build the pgo binary
|runpgo        | run the pgo binary
|runapiserver        | run the apiserver binary outside of Kube
|clean        | remove binaries and compiled packages, restore dependencies
|operatorimage        | compile and build the postgres-operator Docker image
|apiserverimage        | compile and build the apiserver Docker image
|lsimage        | build the lspvc Docker image
|loadimage        | build the file load Docker image
|rmdataimage        | build the data deletion Docker image
|release        | build the postgres-operator release
|======================

== Next Steps

Next, visit the link:/installation/deployment/[Deployment] page to deploy the
Operator, verify the installation, and view various storage configurations.


    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="https://crunchydata.github.io/postgres-operator/installation/quick-installation/" title="Quick Installation"> <i class="fa fa-chevron-left"></i><label>Quick Installation</label></a>
    <a class="nav nav-next" href="https://crunchydata.github.io/postgres-operator/installation/helm-chart/" title="Helm Chart" style="margin-right: 0px;"><label>Helm Chart</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="https://crunchydata.github.io/postgres-operator/js/clipboard.min.js"></script>
<script src="https://crunchydata.github.io/postgres-operator/js/featherlight.min.js"></script>
<script src="https://crunchydata.github.io/postgres-operator/js/html5shiv-printshiv.min.js"></script>

<script src="https://crunchydata.github.io/postgres-operator/js/modernizr.custom.71422.js"></script>
<script src="https://crunchydata.github.io/postgres-operator/js/docdock.js"></script>
<script src="https://crunchydata.github.io/postgres-operator/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>