<!DOCTYPE html>
<html>
  <head>
    <title>Crunchy Data PostgreSQL Operator Documentation</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.40.3" />

<title>Upgrading the Operator :: Crunchy Data PostgreSQL Operator Documentation</title>
<link rel="shortcut icon" href="https://crunchydata.github.io/postgres-operator/favicon.ico" type="image/x-icon" />
<link href="https://crunchydata.github.io/postgres-operator/css/nucleus.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/css/font-awesome.min.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/css/hybrid.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/css/featherlight.min.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/css/auto-complete.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/theme-original/style.css" rel="stylesheet">

<link rel="stylesheet" href="https://crunchydata.github.io/postgres-operator/css/bootstrap.min.css">
<script src="https://crunchydata.github.io/postgres-operator/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<meta name="description" content="">


    
  </head>
  <body data-url="/installation/upgrading-the-operator/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <a class="baselink" href="https://crunchydata.github.io/postgres-operator/">Crunchy Data PostgreSQL Operator Documentation</a>
  

    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/js/lunr.min.js"></script>
		<script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "https:\/\/crunchydata.github.io\/postgres-operator\/";
        
		</script>
		<script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/" class="dd-item">
            <a href="https://crunchydata.github.io/postgres-operator/"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/installation/" class="dd-item parent haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/installation/">Installation</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="/installation/quick-installation/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/quick-installation/">
            Quick Installation
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/manual-installation/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/manual-installation/">
            Manual Installation
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/helm-chart/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/helm-chart/">
            Helm Chart
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/upgrading-the-operator/" class="dd-item active">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/upgrading-the-operator/">
            Upgrading the Operator
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/deployment/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/deployment/">
            Deployment
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/configuration/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/installation/configuration/">
            Configuration
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/contributing/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/contributing/">Contributing</a>

      </div>
    </li>
    <li data-nav-id="/how-it-works/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/how-it-works/">How it Works</a>

      </div>
    </li>
    <li data-nav-id="/getting-started/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/getting-started/">Getting Started</a>

      </div>
    </li>



        <section id="shortcuts">
                <li class="" role=""><h3>More</h3><a href="https://github.com/CrunchyData/postgres-operator" target="_blank" rel="noopener"><i class='fa fa-github'></i> <label>Github repo</label></a></li>
                <li class="" role=""><a href="https://github.com/CrunchyData/postgres-operator/releases/download/2.6/postgres-operator.2.6.tar.gz" target="_blank" rel="noopener"><i class='fa fa-cloud-download'></i> <label>Download</label></a></li>
                <li class="" role=""><a href="https://kubernetes.io/docs/" target="_blank" rel="noopener"><i class='fa fa-bookmark'></i> <label>Kubernetes Documentation</label></a></li>
                <li class="" role=""><a href="https://github.com/CrunchyData/postgres-operator/blob/master/LICENSE.md" target="_blank" rel="noopener"><i class='fa fa-file'></i> <label>License</label></a></li>
        </section>

    <hr />
    <li></li>

    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    
      
      
      
    <div id="top-github-link">
      <a class="github-link" href="https://crunchydata.github.io/postgres-operator/contributing/" target="blank">
        <i class="fa fa-info-circle"></i>
        How to contribute
      </a>
      <a class="github-link" href="https://github.com/CrunchyData/postgres-operator/edit/master/hugo/content/installation/upgrading-the-operator.adoc" target="blank">
        <i class="fa fa-code-fork"></i>
        Improve this page
      </a>
    </div><div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        







 <a href='https://crunchydata.github.io/postgres-operator/'>Crunchy Data PostgreSQL Operator</a> > <a href='https://crunchydata.github.io/postgres-operator/installation/'>Installation</a> > Upgrading the Operator






        </span>
    </div>

    
    <div class="progress">
        <div class="wrapper">
    
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Upgrading the Operator</h1>
  



    
    
    
    v3.0, {docdate}

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
        
        Upgrading from v2.4 to v2.5
        
        </span>
    </div>
    <div class="expand-content" style="display: none;">


For a full list of additions and revisions that occurred in the
PostgreSQL Operator v2.5 release, please view the related release
page link:https://github.com/CrunchyData/postgres-operator/releases/tag/2.5[here].

== Required Updates

This section notes some required steps that will need to be taken
in the process of upgrading from v2.4 to v2.5.

=== Configuration File

It will be necessary to update your existing `pgo.yaml` configuration
file where the Storage Configuration sections are concerned. The updated
file for v2.5 can be found
link:https://github.com/CrunchyData/postgres-operator/blob/2.5/conf/apiserver/pgo.yaml[here].
The file contained within the local installation of the Operator is located
by default in the following location -
....
$COROOT/conf/apiserver/pgo.yaml
....

=== Secrets

2.5 changed the names of the database credentials that are created
by default in order to be consistent with the way new database credentials
are named.

It will be necessary to run the following script to update your
existing clusters. This script will essentially copy the existing
secrets values and create new secrets with those same values but
named to the new standard. Run the script by passing in the name of
an existing cluster as a parameter.

....
$COROOT/bin/upgrade-secret.sh
....


    </div>
</div>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
        
        Upgrading from v2.5 to v2.6
        
        </span>
    </div>
    <div class="expand-content" style="display: none;">


For a full list of additions and revisions that occurred in the
PostgreSQL Operator v2.5 release, please view the related release
page link:https://github.com/CrunchyData/postgres-operator/releases/tag/3.0[here].

== Required Updates

This section notes some required steps that will need to be taken
in the process of upgrading from v2.5 to v2.6.

=== Configuration File

One update in v2.6 changed the `pgo.yaml` file through removing the Debug flag.
The `Pgo.Debug` variable can now be removed from the `pgo.yaml` file as a
result. The debug flag is now called `CRUNCHY_DEBUG` and is set in the
`deployment.json` file as a default environment variable.

=== Container Resources

Release 2.6 added the concept of container resource configurations
to the `pgo.yaml` file. In order to specify the optional container
resource configurations, add a section as follows to your `pgo.yaml`
file -
....
DefaultContainerResource: small
ContainerResources:
 small:
   RequestsMemory:  2Gi
   RequestsCPU:  0.5
   LimitsMemory:  2Gi
   LimitsCPU:  1.0
 large:
   RequestsMemory:  8Gi
   RequestsCPU:  2.0
   LimitsMemory:  12Gi
   LimitsCPU:  4.0
....

<div class="notices warning" >
If these settings are set incorrectly or if the Kubernetes cluster
cannot meet the defined memory and CPU requirements, deployments will go into
a *pending* state.
</div>


=== Kube RBAC

Release 2.6 added a `rbac.yaml` file to capture the Kube RBAC
rules. These RBAC rules allow the *apiserver* and *postgres-operator*
containers access to the Kubernetes resources required for
the operator to work. As part of the deployment process, it is necessary to
execute the `rbac.yaml` file to set the roles and bindings required by the
operator. Adjust this file to suit local security requirements.

=== Application RBAC

Release 2.6 added an RBAC capability to secure the *pgo* application.
The *pgouser* now has a role appended at the end of of each user definition
as follows -
....
username:password:pgoadmin
testuser:testpass:pgoadmin
readonlyuser:testpass:pgoreader
....

These are defined in the following file -
....
$COROOT/conf/apiserver/pgouser
....

To match the behavior of the pre 2.6 releases, the *pgadmin* role
is set on the previous user definitions, but a *readonlyuser* is
now defined to test other role definitions. The roles are defined in
a new file called *pgorole*. This file defines each role and the
permissions for that role. By default, two roles are defined as samples -
....
pgoadmin
pgoreader
....

Adjust these default settings to meet local security requirements.

The format of this file is as follows -
....
rolename: permissionA, permissionB
....

These are defined in the following file -
....
$COROOT/conf/apiserver/pgorole
....

The complete set of permissions is documented in the link:/installation/configuration/[Configuration] document.

=== User Creation

Release 2.6 replaced the `pgo user --add` command with the `pgo create user`
command to improve consistency across command usage. Any scripts written
using the older style of command require an update to use the new command
syntax.

=== Replica CRD

There is a new Kubernetes Custom Resource Definition that serves the purpose
of holding replica information, called *pgreplicas*. This CRD is populated
with the pgo scale command and is used to hold per-replica specific information
such as the resource and storage configurations requested at run time.


    </div>
</div>


    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="https://crunchydata.github.io/postgres-operator/installation/helm-chart/" title="Helm Chart"> <i class="fa fa-chevron-left"></i><label>Helm Chart</label></a>
    <a class="nav nav-next" href="https://crunchydata.github.io/postgres-operator/installation/deployment/" title="Deployment" style="margin-right: 0px;"><label>Deployment</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="https://crunchydata.github.io/postgres-operator/js/clipboard.min.js"></script>
<script src="https://crunchydata.github.io/postgres-operator/js/featherlight.min.js"></script>
<script src="https://crunchydata.github.io/postgres-operator/js/html5shiv-printshiv.min.js"></script>

<script src="https://crunchydata.github.io/postgres-operator/js/modernizr.custom.71422.js"></script>
<script src="https://crunchydata.github.io/postgres-operator/js/docdock.js"></script>
<script src="https://crunchydata.github.io/postgres-operator/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>