<!DOCTYPE html>
<html>
  <head>
    
    <title>Crunchy Data PostgreSQL Operator Documentation</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.55.6" />
<title>pgBackrest with S3 :: Crunchy Data PostgreSQL Operator Documentation</title>
<link rel="shortcut icon" href="https://crunchydata.github.io/postgres-operator/latest/favicon.png" type="image/x-icon" />
<link href="https://crunchydata.github.io/postgres-operator/latest/css/nucleus.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/latest/theme-flex/style.css" rel="stylesheet">

<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
<link href="https://crunchydata.github.io/postgres-operator/latest/css/Fort-Fonts.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/latest/css/custom.css" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
<script src="https://crunchydata.github.io/postgres-operator/latest/js/jquery-2.x.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.bundle.min.js" integrity="sha384-zDnhMsjVZfS3hiP7oCBRmfjkQC4fzxVxFhBx8Hkz2aZX8gEvA/jsP3eXRCvzTofP" crossorigin="anonymous"></script>
<script src="https://crunchydata.github.io/postgres-operator/latest/js/main.js"></script>
<script src="https://crunchydata.github.io/postgres-operator/latest/js/toc.js"></script>
<script type="text/javascript">
      var baseurl = "https:\/\/crunchydata.github.io\/postgres-operator\/latest";
</script>
<meta name="description" content="">



    
  </head>
  <body data-url="/gettingstarted/design/backrest-s3-configuration/">
    
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
  
<a class="navbar-brand" href="https://www.crunchydata.com/"><img alt="Crunchy Data" src="https://crunchydata.github.io/postgres-operator/latest/images/logo.svg"></a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <ul class="navbar-nav mr-auto"></ul>
  <span class="navbar-text">
      <nav class="shortcuts">
              <li class="" role="">
                  <a href="https://github.com/CrunchyData/postgres-operator" target="_blank" rel="noopener">
                    <i class='fab fa-github'></i> <label>Source</label>
                  </a>
              </li>
              <li class="" role="">
                  <a href="https://kubernetes.io/docs/" target="_blank" rel="noopener">
                    <i class='fas fa-bookmark'></i> <label>Kubernetes</label>
                  </a>
              </li>
              <li class="" role="">
                  <a href="https://github.com/CrunchyData/postgres-operator/blob/master/LICENSE.md" target="_blank" rel="noopener">
                    <i class='fas fa-file-contract'></i> <label>License</label>
                  </a>
              </li>
      </nav>
  </span>
</nav>

<article>
  <aside>

    <ul class="menu">
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="">
        </div>
        <script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/latest/js/lunr.min.js"></script>
        <script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/latest/js/auto-complete.js"></script>
        <link href="https://crunchydata.github.io/postgres-operator/latest/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "https:\/\/crunchydata.github.io\/postgres-operator\/latest";
          
        </script>
        <script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/latest/js/search.js"></script>
      </div>

      <hr>
      <a class="baselink" href="https://crunchydata.github.io/postgres-operator/latest/">Crunchy Data PostgreSQL Operator Documentation</a>
      <hr>
        <b>Available Formats</b>
        <nav class="downloads">
                <li class="" role="">
                    <a href="https://crunchydata.github.io/postgres-operator/latest/pdf/postgres_operator.pdf" target="_blank" rel="noopener">
                      <i class='fas fa-file-pdf'></i> <label>PDF</label>
                    </a>
                </li>
                <li class="" role="">
                    <a href="https://crunchydata.github.io/postgres-operator/latest/epub/postgres_operator.epub" target="_blank" rel="noopener">
                      <i class='fas fa-book'></i> <label>EPUB</label>
                    </a>
                </li>
        </nav>
        <hr>

      <b>Navigation</b>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/" class="dd-item parent haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/">Getting Started</a>
            <i class="fas fa-angle-down fa-lg category-icon"></i>

      </div>
        <ul>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/" class="dd-item parent haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/">Design</a>
            <i class="fas fa-angle-down fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/designoverview/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/designoverview/">
            Design
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/custom-config/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/custom-config/">
            Custom Configuration
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/custom-config-ssl/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/custom-config-ssl/">
            Custom SSL Configuration
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/multi-zone-design-considerations/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/multi-zone-design-considerations/">
            Multi-Zone Cloud Considerations
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/direct-api-calls/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/direct-api-calls/">
            Rest API
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/backrest-s3-configuration/" class="dd-item active">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/backrest-s3-configuration/">
            pgBackrest with S3
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/eventing/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/eventing/">
            Eventing
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/namespace/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/namespace/">
            Namespace
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/olm/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/olm/">
            Operator Lifecycle Management Support
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/prereq/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/prereq/">Prerequisites</a>

      </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/" class="dd-item haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/installation/">Installation</a><i class="fas fa-angle-right fa-lg category-icon"></i>

      </div>
        <ul>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/" class="dd-item haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/">Install Operator Using Ansible</a><i class="fas fa-angle-right fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/prerequisites/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/prerequisites/">
            Prerequisites
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/installing-ansible/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/installing-ansible/">
            Installing Ansible
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/installing-operator/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/installing-operator/">
            Installing PostgreSQL Operator
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/installing-metrics/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/installing-metrics/">
            Installing Metrics Infrastructure
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/updating-operator/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/updating-operator/">
            Updating PostgreSQL Operator
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/uninstalling-operator/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/uninstalling-operator/">
            Uninstalling PostgreSQL Operator
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/uninstalling-metrics/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/install-with-ansible/uninstalling-metrics/">
            Uninstalling Metrics Stack
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/install-pgo-client/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/installation/install-pgo-client/">Install `pgo` Client</a>

      </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/operator-install/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/operator-install/">
            Install Operator Using Bash
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/installation/developer-setup/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/developer-setup/">
            Developer Setup
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/configuration/" class="dd-item haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/configuration/">Configuration</a><i class="fas fa-angle-right fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/configuration/compatibility/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/configuration/compatibility/">
            Compatibility Requirements
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/configuration/configuration/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/configuration/configuration/">
            Configuration Resources
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/configuration/pgo-yaml-configuration/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/configuration/pgo-yaml-configuration/">
            PGO YAML
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/overview/" class="dd-item haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/overview/">Overview</a><i class="fas fa-angle-right fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/overview/node-affinitiy-overview/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/overview/node-affinitiy-overview/">
            Node Affinity in PostgreSQL Operator
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/overview/storage-overview/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/overview/storage-overview/">
            Storage Overview
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/overview/custom-resource-definitions/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/overview/custom-resource-definitions/">
            Custom Resource Definitions Overview
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/overview/scheduler-overview/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/overview/scheduler-overview/">
            PGO Scheduler Overview
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/overview/backup-restore-overview/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/overview/backup-restore-overview/">
            PostgreSQL Operator Backup and Restore Capability
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/overview/postgres-operator-overview/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/overview/postgres-operator-overview/">
            PostgreSQL Operator Overview
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/overview/users-role-overview/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/overview/users-role-overview/">
            PostgreSQL Operator User Roles Overview
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/overview/failover-overview/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/overview/failover-overview/">
            Failover in the PostgreSQL Operator Overview
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/overview/postgres-operator-containers-overview/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/overview/postgres-operator-containers-overview/">
            PostgreSQL Operator Containers Overview
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/overview/namespace-overview/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/overview/namespace-overview/">
            PostgreSQL Operator Namespace Considerations Overview
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/" class="dd-item haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/">Operator Command Line Utility</a><i class="fas fa-angle-right fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/pgo-overview/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/pgo-overview/">
            Operator CLI Overview
          </a>
        </div>
    </li>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/" class="dd-item haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/">Operator CLI</a><i class="fas fa-angle-right fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo/">
            pgo
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_apply/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_apply/">
            pgo_apply
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_backup/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_backup/">
            pgo_backup
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_benchmark/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_benchmark/">
            pgo_benchmark
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_cat/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_cat/">
            pgo_cat
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_clidoc/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_clidoc/">
            pgo_clidoc
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create/">
            pgo_create
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_cluster/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_cluster/">
            pgo_create_cluster
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_namespace/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_namespace/">
            pgo_create_namespace
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_pgbouncer/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_pgbouncer/">
            pgo_create_pgbouncer
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_pgorole/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_pgorole/">
            pgo_create_pgorole
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_pgouser/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_pgouser/">
            pgo_create_pgouser
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_pgpool/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_pgpool/">
            pgo_create_pgpool
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_policy/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_policy/">
            pgo_create_policy
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_schedule/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_schedule/">
            pgo_create_schedule
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_user/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_create_user/">
            pgo_create_user
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete/">
            pgo_delete
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_backup/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_backup/">
            pgo_delete_backup
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_benchmark/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_benchmark/">
            pgo_delete_benchmark
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_cluster/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_cluster/">
            pgo_delete_cluster
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_label/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_label/">
            pgo_delete_label
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_namespace/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_namespace/">
            pgo_delete_namespace
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_pgbouncer/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_pgbouncer/">
            pgo_delete_pgbouncer
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_pgorole/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_pgorole/">
            pgo_delete_pgorole
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_pgouser/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_pgouser/">
            pgo_delete_pgouser
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_pgpool/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_pgpool/">
            pgo_delete_pgpool
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_policy/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_policy/">
            pgo_delete_policy
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_schedule/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_schedule/">
            pgo_delete_schedule
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_upgrade/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_upgrade/">
            pgo_delete_upgrade
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_user/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_delete_user/">
            pgo_delete_user
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_df/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_df/">
            pgo_df
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_failover/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_failover/">
            pgo_failover
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_label/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_label/">
            pgo_label
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_load/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_load/">
            pgo_load
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_ls/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_ls/">
            pgo_ls
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_reload/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_reload/">
            pgo_reload
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_restore/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_restore/">
            pgo_restore
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_scale/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_scale/">
            pgo_scale
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_scaledown/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_scaledown/">
            pgo_scaledown
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show/">
            pgo_show
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_backup/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_backup/">
            pgo_show_backup
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_benchmark/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_benchmark/">
            pgo_show_benchmark
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_cluster/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_cluster/">
            pgo_show_cluster
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_config/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_config/">
            pgo_show_config
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_namespace/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_namespace/">
            pgo_show_namespace
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_pgorole/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_pgorole/">
            pgo_show_pgorole
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_pgouser/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_pgouser/">
            pgo_show_pgouser
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_policy/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_policy/">
            pgo_show_policy
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_pvc/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_pvc/">
            pgo_show_pvc
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_schedule/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_schedule/">
            pgo_show_schedule
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_upgrade/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_upgrade/">
            pgo_show_upgrade
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_user/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_user/">
            pgo_show_user
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_workflow/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_show_workflow/">
            pgo_show_workflow
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_status/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_status/">
            pgo_status
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_test/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_test/">
            pgo_test
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update/">
            pgo_update
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update_cluster/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update_cluster/">
            pgo_update_cluster
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update_namespace/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update_namespace/">
            pgo_update_namespace
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update_pgorole/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update_pgorole/">
            pgo_update_pgorole
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update_pgouser/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update_pgouser/">
            pgo_update_pgouser
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update_user/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_update_user/">
            pgo_update_user
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_upgrade/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_upgrade/">
            pgo_upgrade
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_user/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_user/">
            pgo_user
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_version/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_version/">
            pgo_version
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_watch/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/operatorcli/cli/pgo_watch/">
            pgo_watch
          </a>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/security/" class="dd-item haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/security/">RBAC Configuration</a><i class="fas fa-angle-right fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/security/configure-postgres-operator-rbac/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/security/configure-postgres-operator-rbac/">
            Configuration of PostgreSQL Operator RBAC
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/security/install-postgres-operator-rbac/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/security/install-postgres-operator-rbac/">
            Installation of PostgreSQL Operator RBAC
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/security/api-encryption-configuration/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/security/api-encryption-configuration/">
            PostgreSQL Operator API Encryption Configuration
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/upgrade/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/upgrade/">Upgrade</a>

      </div>
    </li>
    <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/contributing/" class="dd-item haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/contributing/">Contributing</a><i class="fas fa-angle-right fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/contributing/documentation-updates/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/contributing/documentation-updates/">
            Updating Documentation
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/contributing/issues/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/contributing/issues/">
            Submitting Issues
          </a>
        </div>
    </li>
      <li data-nav-id="https://crunchydata.github.io/postgres-operator/latest/contributing/pull-requests/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/contributing/pull-requests/">
            Submitting Pull Requests
          </a>
        </div>
    </li>
        </ul>
    </li>




      <hr><nav id="TableOfContents"></nav>



      <section>
      </section>
    </ul>
  </aside>
  <section class="page">

    <div class="nav-select">
      <center>Navigation :
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/gettingstarted/" >
   Getting Started</option> 
    <option value="/gettingstarted/design/" >
  - 
   Design</option> 
      <option value="/gettingstarted/design/designoverview/" >-- Design</option>
      <option value="/gettingstarted/design/custom-config/" >-- Custom Configuration</option>
      <option value="/gettingstarted/design/custom-config-ssl/" >-- Custom SSL Configuration</option>
      <option value="/gettingstarted/design/multi-zone-design-considerations/" >-- Multi-Zone Cloud Considerations</option>
      <option value="/gettingstarted/design/direct-api-calls/" >-- Rest API</option>
      <option value="/gettingstarted/design/backrest-s3-configuration/"  selected>-- pgBackrest with S3</option>
      <option value="/gettingstarted/design/eventing/" >-- Eventing</option>
      <option value="/gettingstarted/design/namespace/" >-- Namespace</option>
      <option value="/gettingstarted/design/olm/" >-- Operator Lifecycle Management Support</option>
  
    <option value="/gettingstarted/prereq/" >
  - 
   Prerequisites</option>
  
    <option value="/installation/" >
   Installation</option>
    <option value="/configuration/" >
   Configuration</option>
    <option value="/overview/" >
   Overview</option>
    <option value="/operatorcli/" >
   Operator Command Line Utility</option>
    <option value="/security/" >
   RBAC Configuration</option>
    <option value="/upgrade/" >
   Upgrade</option>
    <option value="/contributing/" >
   Contributing</option>



        </select>
      </center>
    </div>

    
      <div id="top-bar">
        
          
          
          
        <div id="top-github-link">
          <a class="github-link" href="https://crunchydata.github.io/postgres-operator/latest/contributing/" target="blank">
            <i class="fa fa-info-circle"></i>
            
          </a>
          <a class="github-link" href="https://github.com/CrunchyData/postgres-operator/edit/develop/hugo/content/gettingstarted/Design/backrest-s3-configuration.md" target="blank">
            <i class="fa fa-code-fork"></i>
            
          </a>
        </div><div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                <i class="fa fa-bars"></i>
              </a>
            </span>
            <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
            <span class="links">
            










 <a href='https://crunchydata.github.io/postgres-operator/latest/'>Crunchy Data Postgres Operator</a> > <a href='https://crunchydata.github.io/postgres-operator/latest/gettingstarted/'>Getting Started</a> > <a href='https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/'>Design</a> > pgBackrest with S3

 

 

 


            </span>
        </div>

      </div>
    

    
    <div id="body-inner">

    <h1>pgBackrest with S3</h1>

    

    
    

<h2 id="pgbackrest-configuration">pgbackrest Configuration</h2>

<p>The PostgreSQL Operator integrates various features of the <a href="https://pgbackrest.org">pgbackrest backup and restore project</a>.</p>

<p>The <em>pgo-backrest-repo</em> container acts as a pgBackRest remote repository for the Postgres cluster to use for storing archive files and backups.</p>

<p>The following diagrams depicts some of the integration features:</p>

<p><img src="https://crunchydata.github.io/postgres-operator/latest/operator-backrest-integration.png" alt="alt text" title="Operator Backrest Integration" /></p>

<p>In this diagram, starting from left to right we see the following:</p>

<ul>
<li><p>a user when they enter <em>pgo backup mycluster &ndash;backup-type=pgbackrest</em> will cause a pgo-backrest container to be run as a Job, that container will execute a   <em>pgbackrest backup</em>
command in the pgBackRest repository container to perform the backup function.</p></li>

<li><p>a user when they enter <em>pgo show backup mycluster &ndash;backup-type=pgbackrest</em> will cause a <em>pgbackrest info</em> command to be executed on the pgBackRest repository container, the
<em>info</em> output is sent directly back to the user to view</p></li>

<li><p>the PostgreSQL container itself will use an archive command, <em>pgbackrest archive-push</em> to send archives to the pgBackRest repository container</p></li>

<li><p>the user entering <em>pgo create cluster mycluster &ndash;pgbackrest</em> will cause
a pgBackRest repository container deployment to be created, that repository
is exclusively used for this Postgres cluster</p></li>

<li><p>lastly, a user entering <em>pgo restore mycluster</em> will cause a <em>pgo-backrest-restore</em> container to be created as a Job, that container executes the <em>pgbackrest restore</em> command</p></li>
</ul>

<h3 id="pgbackrest-restore">pgbackrest Restore</h3>

<p>The pgbackrest restore command is implemented as the <em>pgo restore</em> command.  This command is destructive in the sense that it is meant to <em>restore</em> a PG cluster meaning it will
revert the PG cluster to a restore point that is kept in the pgbackrest repository.   The prior primary data is not deleted but left in a PVC to be manually cleaned up by a DBA.
The restored PG cluster will work against a new PVC created from the restore workflow.</p>

<p>When doing a <em>pgo restore</em>, here is the workflow the PostgreSQL Operator executes:</p>

<ul>
<li>turn off autofail if it is enabled for this PG cluster</li>
<li>allocate a new PVC to hold the restored PG data</li>
<li>delete the the current primary database deployment</li>
<li>update the pgbackrest repo for this PG cluster with a new data path of the new PVC</li>
<li>create a pgo-backrest-restore job, this job executes the <em>pgbackrest restore</em> command from the pgo-backrest-restore container, this Job mounts the newly created PVC</li>
<li>once the restore job completes, a new primary Deployment is created which mounts the restored PVC volume</li>
</ul>

<p>At this point the PostgreSQL database is back in a working state.  DBAs are still responsible to re-enable autofail using <em>pgo update cluster</em> and also perform a pgBackRest backup after the new primary is ready.  This version of the PostgreSQL Operator also does not handle any errors in the PG replicas after a restore, that is left for the DBA to handle.</p>

<p>Other things to take into account before you do a restore:</p>

<ul>
<li>if a schedule has been created for this PostgreSQL cluster, delete that schedule prior to performing a restore</li>
<li>If your database has been paused after the target restore was completed, then you would need to run the psql command select pg_wal_replay_resume() to complete the recovery, on PostgreSQL 9.<sup>6</sup>&frasl;<sub>9</sub>.5 systems, the command you will use is select pg_xlog_replay_resume(). You can confirm the status of your database by using the built in postgres admin functions
found <a href="https://www.postgresql.org/docs/current/functions-admin.html#FUNCTIONS-RECOVERY-CONTROL-TABLE">here:</a></li>
<li>a pgBackRest restore is destructive in the sense that it deletes the existing primary deployment for the cluster prior to creating a new deployment containing the restored
primary database.  However, in the event that the pgBackRest restore job fails, the <code>pgo restore</code> command be can be run again, and instead of first deleting the primary deployment
(since one no longer exists), a new primary will simply be created according to any options specified.  Additionally, even though the original primary deployment will be deleted,
the original primary PVC will remain.</li>
<li>there is currently no Operator validation of user entered pgBackRest command options, you will need to make sure to enter these correctly, if not the pgBackRest restore command
can fail.</li>
<li>the restore workflow does not perform a backup after the restore nor does it verify that any replicas are in a working status after the restore, it is possible you might have to
take actions on the replica to get them back to replicating with the new restored primary.</li>
<li>pgbackrest.org suggests running a pgbackrest backup after a restore, this needs to be done by the DBA as part of a restore</li>
<li>when performing a pgBackRest restore, the <strong>node-label</strong> flag can be utilized to target a specific node for both the pgBackRest restore job and the new (i.e. restored) primary
deployment that is then created for the cluster.  If a node label is not specified, the restore job will not target any specific node, and the restored primary deployment will
inherit any node labels defined for the original primary deployment.</li>
</ul>

<h3 id="pgbackrest-aws-s3-support">pgbackrest AWS S3 Support</h3>

<p>The PostgreSQL Operator supports the use AWS S3 storage buckets for the pgbackrest repository in any pgbackrest-enabled cluster.  When S3 support is enabled for a cluster, all
archives will automatically be pushed to a pre-configured S3 storage bucket, and that same bucket can then be utilized for the creation of any backups as well as when performing
restores.  Please note that once a storage type has been selected for a cluster during cluster creation (specifically <code>local</code>, <code>s3</code>, or <em>both</em>, as described in detail below), it
cannot be changed.</p>

<p>The PostgreSQL Operator allows for the configuration of a single storage bucket, which can then be utilized across multiple clusters.  Once S3 support has been enabled for a
cluster, pgbackrest will create a <code>backrestrepo</code> directory in the root of the configured S3 storage bucket (if it does not already exist), and subdirectories will then be created
under the <code>backrestrepo</code> directory for each cluster created with S3 storage enabled.</p>

<h4 id="s3-configuration">S3 Configuration</h4>

<p>In order to enable S3 storage, you must provide the required AWS S3 configuration information prior to deploying the Operator.  First, you will need to add the proper S3 bucket
name, AWS S3 endpoint and AWS S3 region to the <code>Cluster</code> section of the <code>pgo.yaml</code> configuration file (additional information regarding the configuration of the <code>pgo.yaml</code> file can
be found <a href="https://crunchydata.github.io/postgres-operator/latest/configuration/pgo-yaml-configuration/">here</a>)  :</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">Cluster<span style="color:#111">:</span>
  BackrestS3Bucket<span style="color:#111">:</span> containers-dev-pgbackrest
  BackrestS3Endpoint<span style="color:#111">:</span> s3.amazonaws.com
  BackrestS3Region<span style="color:#111">:</span> us-east-<span style="color:#ae81ff">1</span></code></pre></div>
<p>You will then need to specify the proper credentials for authenticating into the S3 bucket specified by adding a <strong>key</strong> and <strong>key secret</strong> to the <code>$PGOROOT/conf/pgo-backrest
repo/aws-s3-credentials.yaml</code> configuration file:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
aws-s3-key<span style="color:#111">:</span> ABCDEFGHIJKLMNOPQRST
aws-s3-key-secret<span style="color:#111">:</span> ABCDEFG/HIJKLMNOPQSTU/VWXYZABCDEFGHIJKLM</code></pre></div>
<p>Once the above configuration details have been provided, you can deploy the Operator per the <a href="https://crunchydata.github.io/postgres-operator/latest/installation/operator-install/">PGO installation instructions</a>.</p>

<h4 id="enabling-s3-storage-in-a-cluster">Enabling S3 Storage in a Cluster</h4>

<p>With S3 storage properly configured within your PGO installation, you can now select either local storage, S3 storage, or <em>both</em> when creating a new cluster.  The type of storage
selected upon creation of the cluster will determine the type of storage that can subsequently be used when performing pgbackrest backups and restores.  A storage type is specified
using the <code>--pgbackrest-storage-type</code> flag, and can be one of the following values:</p>

<ul>
<li><code>local</code> - pgbackrest will use volumes local to the container (e.g. Persistent Volumes) for storing archives, creating backups and locating backups for restores.  This is the
default value for the <code>--pgbackrest-storage-type</code> flag.</li>
<li><code>s3</code> - pgbackrest will use the pre-configured AWS S3 storage bucket for storing archives, creating backups and locating backups for restores</li>
<li><code>local,s3</code> (both) - pgbackrest will use both volumes local to the container (e.g. persistent volumes), as well as the pre-configured AWS S3 storage bucket, for storing archives.
Also allows the use of local and/or S3 storage when performing backups and restores.</li>
</ul>

<p>For instance, the following command enables both <code>local</code> and <code>s3</code> storage in a new cluster:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pgo create cluster mycluster --pgbackrest-storage-type<span style="color:#f92672">=</span>local,s3 -n pgouser1</code></pre></div>
<p>As described above, this will result in pgbackrest pushing archives to both local and S3 storage, while also allowing both local and S3 storage to be utilized for backups and
restores.  However, you could also enable S3 storage only when creating the cluster:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pgo create cluster mycluster --pgbackrest-storage-type<span style="color:#f92672">=</span>s3 -n pgouser1</code></pre></div>
<p>Now all archives for the cluster will be pushed to S3 storage only, and local storage will not be utilized for storing archives (nor can local storage be utilized for backups and
restores).</p>

<h4 id="using-s3-to-backup-restore">Using S3 to Backup &amp; Restore</h4>

<p>As described above, once S3 storage has been enabled for a cluster, it can also be used when backing up or restoring a cluster.  Here a both local and S3 storage is selected when
performing a backup:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pgo backup mycluster --backup-type<span style="color:#f92672">=</span>pgbackrest --pgbackrest-storage-type<span style="color:#f92672">=</span>local,s3 -n pgouser1</code></pre></div>
<p>This results in pgbackrest creating a backup in a local volume (e.g. a persistent volume), while also creating an additional backup in the configured S3 storage bucket.  However, a
backup can be created using S3 storage only:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pgo backup mycluster --backup-type<span style="color:#f92672">=</span>pgbackrest --pgbackrest-storage-type<span style="color:#f92672">=</span>s3 -n pgouser1</code></pre></div>
<p>Now pgbackrest will only create a backup in the S3 storage bucket only.</p>

<p>When performing a restore, either <code>local</code> or <code>s3</code> must be selected (selecting both for a restore will result in an error).  For instance, the following command specifies S3 storage
for the restore:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pgo restore mycluster --pgbackrest-storage-type<span style="color:#f92672">=</span>s3 -n pgouser1</code></pre></div>
<p>This will result in a full restore utilizing the backups and archives stored in the configured S3 storage bucket.</p>

<p><em>Please note that because <code>local</code> is the default storage type for the <code>backup</code> and <code>restore</code> commands, <code>s3</code> must be explicitly set using the <code>--pgbackrest-storage-type</code> flag when
performing backups and restores on clusters where only S3 storage is enabled.</em></p>

<h4 id="aws-certificate-authority">AWS Certificate Authority</h4>

<p>The PostgreSQL Operator installation includes a default certificate bundle that is utilized by default to establish trust between pgbackrest and the AWS S3 endpoint used for S3
storage.  Please modify or replace this certificate bundle as needed prior to deploying the Operator if another certificate authority is needed to properly establish trust between pgbackrest
and your S3 endpoint.</p>

<p>The certificate bundle can be found here: <code>$PGOROOT/pgo-backrest-repo/aws-s3-ca.crt</code>.</p>

<p>When modifying or replacing the certificate bundle, please be sure to maintain the same path and filename.</p>



    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/direct-api-calls/" title="Rest API"> <i class="fa fa-chevron-left"></i><label>Rest API</label></a>
    <a class="nav nav-next" href="https://crunchydata.github.io/postgres-operator/latest/gettingstarted/design/eventing/" title="Eventing" style="margin-right: 0px;"><label>Eventing</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

  

  </div>


	<div>
	</div>
</footer>

<link href="https://crunchydata.github.io/postgres-operator/latest/css/featherlight.min.css" rel="stylesheet">
<script src="https://crunchydata.github.io/postgres-operator/latest/js/featherlight.min.js"></script>

<script src="https://crunchydata.github.io/postgres-operator/latest/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>
